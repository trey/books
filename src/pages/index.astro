---
import Layout from "../layouts/Layout.astro";
import {
   DATA_URL,
   getSecret
} from "astro:env/server";

const response = await fetch(getSecret("DATA_URL"));
const data = await response.json();
---

<Layout>
    <form class="js">
        <ul class="space-y-2">
            {data.map((item) => (
                <li>
                    <label class="block p-4 rounded-md">
                        <input class="hidden" type="radio" name="source" value={item.slug} />
                        {item.name}
                    </label>
                </li>
            ))}
        </ul>
        <div class="form-wrapper mt-10 flex justify-between items-stretch gap-2">
            <input type="search" name="q" class="border-2 border-sky-300 dark:border-white text-black bg-white p-2 rounded-md grow" />
            <button class="rounded-md bg-sky-500 hover:bg-sky-800 focus:bg-sky-800 dark:bg-sky-700 dark:hover:bg-sky-600 cursor-pointer text-white py-2 px-3">Search</button>
        </div>
    </form>

    <ul class="no-js">
        {data.map((item) => (
            <li>
                {item.url
                    ? <a href={item.url}>{item.name}</a>
                    : item.name
                }
                <form id={`form_${item.slug}`} action={item.action}>
                    {item.slug === 'norwich' && (
                        <input type="hidden" name="searchtype" value="keyword">
                        <input type="hidden" name="qs_file" value="">
                        <input type="hidden" name="q" value="h.tviewer">
                        <input type="hidden" name="using_sb" value="status">
                        <input type="hidden" name="qsb" value="keyword">
                    )}
                    <input type="search" name={item.field ? item.field : "q"} />
                    <button>Search</button>
                </form>
            </li>
        ))}
    </ul>
</Layout>
